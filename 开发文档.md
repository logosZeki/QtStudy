# 流程图软件开发文档

## 项目概述
本软件是一个基于Qt框架开发的简单流程图编辑工具，允许用户创建、编辑和连接各种形状的流程框，以图形化方式表达流程和逻辑关系。

## 功能需求

### 1. 流程框组件

#### 1.1 流程框类型
- 圆角矩形
- 矩形
- 三角形
- 菱形
- 其他基本几何形状

#### 1.2 流程框操作
- 从左侧组件库拖动到编辑区创建
- 在编辑区内自由拖动调整位置
- 调整大小
- 编辑文本内容
- 删除流程框


### 3. 用户界面

#### 3.1 编辑区
- 主要工作区域，用于放置流程框
- 支持缩放和平移操作
- 网格背景辅助对齐
- 按下backspace键删除流程框

#### 3.2 组件库
- 位于界面最左侧
- 展示各种可用的流程框类型
- 支持拖放到编辑区

#### 3.3 工具栏
- 提供常用操作按钮
- 保存/加载流程图
- 撤销/重做操作
- 对齐工具

## 技术架构

### 1. 核心类设计

#### 1.1 `FlowChartScene` 类
- 继承自 `QGraphicsScene`
- 管理所有流程图元素
- 处理元素之间的交互

#### 1.2 `FlowChartView` 类
- 继承自 `QGraphicsView`
- 显示流程图场景
- 处理用户输入和缩放/平移

#### 1.3 `FlowChartItem` 类
- 继承自 `QGraphicsItem`
- 流程框的基类
- 定义公共属性和行为

#### 1.4 具体形状类
- `RectangleItem`、`RoundRectItem`、`DiamondItem`、`TriangleItem` 等
- 继承自 `FlowChartItem`
- 实现各自的绘制逻辑

#### 1.5 `ConnectionLine` 类
- 继承自 `QGraphicsPathItem`
- 表示流程框之间的连接线
- 处理箭头绘制和路径计算

#### 1.6 `ConnectionPoint` 类
- 表示流程框上的连接点
- 处理连接线的拖拽和连接

### 2. 事件处理

#### 2.1 拖放实现
- 使用Qt的拖放机制实现从组件库到编辑区的拖放
- 自定义MIME类型处理流程框创建

#### 2.2 连接线创建
- 鼠标按下事件触发连接线创建
- 鼠标移动事件更新连接线路径
- 鼠标释放事件完成连接操作

#### 2.3 元素选择和移动
- 实现物品选择机制
- 处理多选和批量移动

### 3. 数据结构

#### 3.1 流程图数据模型
- 存储流程框和连接线信息
- 支持序列化和反序列化

## 实现计划

### 第一阶段：基础框架
1. 创建主窗口和布局
2. 实现 `FlowChartScene` 和 `FlowChartView`
3. 设计基本的 `FlowChartItem` 类

### 第二阶段：流程框实现
1. 开发各种形状的流程框类
2. 实现拖放机制
3. 添加选择和移动功能

### 第三阶段：连接线功能
1. 实现连接点识别
2. 开发连接线创建和编辑功能
3. 添加箭头渲染

### 第四阶段：用户体验优化
1. 完善编辑操作
2. 添加撤销/重做功能
3. 实现保存/加载功能

## 技术要点

### 1. Qt Graphics View框架
- 利用 `QGraphicsScene`、`QGraphicsView` 和 `QGraphicsItem` 构建流程图
- 使用坐标系统和变换处理视图

### 2. 事件处理
- 自定义鼠标事件处理实现拖放和连接操作
- 使用事件过滤器捕获特定交互

### 3. 绘图算法
- 使用 `QPainter` 和 `QPainterPath` 绘制各种形状
- 计算连接线路径和箭头位置

### 4. 数据持久化
- 设计JSON数据结构存储流程图
- 实现流程图的保存和加载功能
